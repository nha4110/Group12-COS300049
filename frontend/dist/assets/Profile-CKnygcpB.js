import{c as _,j as e,d as D,r as d,P as F,T as r,B as P,b as W,G as U,a as $,m as A,M as R,p as J,e as G,u as H,D as L,g as Y,f as K,C as M,A as V,h as q,J as Q}from"./index-BaiZDlTz.js";import{C as X,a as Z,b as ee}from"./CardMedia-f9LVn6NY.js";import{T as S,F as te,I as ae,S as ne}from"./TextField-D2dsXHRM.js";import{B as E}from"./Button-aGJUPGZF.js";import{T as oe,a as I}from"./Tabs-COGSINym.js";const se=_(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle"),re=_(e.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections"),k=_(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),ie="http://localhost:8081",le=()=>{var j;const{state:h}=D(),[a,f]=d.useState([]),[o,u]=d.useState(!0),[g,c]=d.useState(null),p=(j=h==null?void 0:h.user)==null?void 0:j.wallet_address;return d.useEffect(()=>{(async()=>{if(!p){c("Please log in to view your NFT collection."),u(!1);return}try{const m=await $.get(`${ie}/assets/${p}`,{headers:{Authorization:`Bearer ${localStorage.getItem("jwtToken")}`}});m.data.success?f(m.data.assets):c("Failed to fetch NFT collection.")}catch(m){console.error("Error fetching NFTs:",m),c("Error loading your NFT collection. Please try again later.")}finally{u(!1)}})()},[p]),o?e.jsxs(F,{elevation:3,sx:{padding:3,marginTop:2},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"NFT Collection "}),e.jsxs(P,{sx:{display:"flex",justifyContent:"center",my:4},children:[e.jsx(W,{})," "]})]}):g?e.jsxs(F,{elevation:3,sx:{padding:3,marginTop:2},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"NFT Collection "}),e.jsx(r,{color:"error",children:g})," "]}):e.jsxs(F,{elevation:3,sx:{padding:3,marginTop:2},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"NFT Collection "}),a.length===0?e.jsx(r,{children:"You donâ€™t own any NFTs yet."}):e.jsx(U,{container:!0,spacing:4,children:a.map(i=>e.jsxs(U,{item:!0,xs:12,sm:6,md:4,children:[" ",e.jsxs(X,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(P,{sx:{position:"relative",pt:"100%"},children:e.jsx(Z,{component:"img",image:i.image_url,alt:i.nft_name,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain"},onError:m=>{m.target.src="https://via.placeholder.com/400?text=Image+Not+Found",m.target.onerror=null}})}),e.jsxs(ee,{sx:{flexGrow:1},children:[e.jsxs(r,{gutterBottom:!0,variant:"h5",component:"h2",children:[i.nft_name," "]}),e.jsxs(r,{variant:"caption",display:"block",color:"text.secondary",children:["Token ID: ",i.token_id," "]}),e.jsxs(r,{variant:"caption",display:"block",color:"text.secondary",children:["Price: ",i.price_eth," ETH "]}),e.jsxs(r,{variant:"caption",display:"block",color:"text.secondary",children:["Category: ",i.category," "]})]})]})]},i.asset_id))})]})},ce="http://localhost:8081",de=({walletAddress:h,provider:a,fetchBalance:f,balance:o})=>{const[u,g]=d.useState(""),[c,p]=d.useState(""),[j]=d.useState("2"),[i,m]=d.useState([]),[v,T]=d.useState("");d.useEffect(()=>{C()},[]);const C=async()=>{try{const t=localStorage.getItem("jwtToken"),n=await $.get(`${ce}/api/users`,{headers:{Authorization:`Bearer ${t}`}});n.data.success?m(n.data.users):console.error("Failed to fetch users:",n.data.message)}catch(t){console.error("Error fetching users:",t),alert("Failed to load user list. Please try again.")}},b=t=>{const n=t.target.value;T(n);const l=i.find(x=>x.username===n);g(l?l.wallet_address:"")},s=async()=>{if(!h||!u||!c){alert("Please enter all fields.");return}if(!a){alert("No Ethereum provider available. Please connect a wallet (e.g., MetaMask).");return}try{const t=await a.getSigner();if((await t.getAddress()).toLowerCase()!==h.toLowerCase()){alert("Your MetaMask account does not match the wallet address provided. Please switch accounts.");return}const l={to:u,value:G(c),gasPrice:J(j,"gwei")},x=await t.sendTransaction(l);await x.wait();const w={sender:h,recipient:u,amount:c,hash:x.hash,date:new Date().toISOString(),type:"balanceTransfer"},N=JSON.parse(localStorage.getItem("balanceTransactions"))||[];localStorage.setItem("balanceTransactions",JSON.stringify([...N,w])),alert("Transaction successful! Reloading page..."),f(h),window.dispatchEvent(new Event("balanceUpdated"))}catch(t){console.error("Transaction Error:",t),alert(`Transaction Failed: ${t.message}`)}};return e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:e.jsxs(F,{elevation:4,sx:{p:4,borderRadius:3,background:"linear-gradient(135deg, #f9f9f9, #e8ecef)",boxShadow:"0 6px 18px rgba(0, 0, 0, 0.08)"},children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold",color:"#2c3e50",display:"flex",alignItems:"center",gap:1},children:[e.jsx(k,{})," Send ETH "]}),e.jsx(r,{variant:"body2",sx:{color:"#7f8c8d",mb:3},children:"Transfer ETH directly to another wallet. "}),e.jsx(S,{label:"Your Wallet Address",fullWidth:!0,margin:"normal",value:h,InputProps:{readOnly:!0},sx:{bgcolor:"#fff",borderRadius:1}}),e.jsxs(te,{fullWidth:!0,margin:"normal",children:[e.jsx(ae,{sx:{color:"#34495e"},children:"Recipient Username"}),e.jsxs(ne,{value:v,onChange:b,label:"Recipient Username",sx:{bgcolor:"#fff",borderRadius:1},children:[e.jsxs(R,{value:"",children:[e.jsx("em",{children:"Select a user"})," "]}),i.map(t=>e.jsxs(R,{value:t.username,children:[t.username," "]},t.wallet_address))]})]}),e.jsx(S,{label:"Recipient Address",fullWidth:!0,margin:"normal",value:u,InputProps:{readOnly:!0},sx:{bgcolor:"#fff",borderRadius:1}}),e.jsx(S,{label:"Amount (ETH)",fullWidth:!0,margin:"normal",value:c,onChange:t=>p(t.target.value),type:"number",sx:{bgcolor:"#fff",borderRadius:1}}),e.jsxs(r,{variant:"body1",sx:{mt:2,color:"#27ae60"},children:["Current Balance: ",o," ETH "]}),e.jsx(E,{variant:"contained",color:"primary",onClick:s,sx:{mt:3,py:1.5,borderRadius:2,background:"linear-gradient(90deg, #6e8efb, #a777e3)","&:hover":{background:"linear-gradient(90deg, #5d78e6, #9366d2)"}},startIcon:e.jsx(k,{}),children:"Send ETH"})]})})},ue="5d8b1175b86f0bee927f",he="ec8a03ff57c136893e7777bcd502255d0d0f8e17a738a3163af51c1bfb07242a",pe="https://api.pinata.cloud/pinning/pinFileToIPFS",ge=async(h,a,f)=>{var o;try{for(let[g,c]of h.entries())console.log(`FormData entry: ${g} = ${c.name||c}`);return{IpfsHash:(await $.post(pe,h,{headers:{"Content-Type":"multipart/form-data",pinata_api_key:ue,pinata_secret_api_key:he},params:{pinataMetadata:JSON.stringify({name:`${f}_${a}`}),pinataOptions:JSON.stringify({cidVersion:1,wrapWithDirectory:!0})}})).data.IpfsHash}}catch(u){throw console.error("Pinata upload error:",((o=u.response)==null?void 0:o.data)||u.message),new Error(`Pinata upload failed: ${u.message}`)}},me="http://localhost:8081",xe=({walletAddress:h})=>{H();const[a,f]=d.useState(""),[o,u]=d.useState([{pngFile:null,name:"",description:"",jsonBlob:null}]),[g,c]=d.useState(!1),[p,j]=d.useState(""),[i,m]=d.useState(1),v=(t,n)=>{if(!n||!n.type.includes("image/png")){alert("Please upload a valid PNG file.");return}const l=[...o];l[t].pngFile=n,u(l)},T=(t,n,l)=>{const x=[...o];x[t][n]=l,u(x)},C=t=>{const n=o[t];if(!n.pngFile||!n.name||!n.description){alert("Please upload a PNG and enter a name and description first.");return}const l=i+t,x={name:n.name,description:n.description,image:`${a}/${l}.png`},w=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),N=`${l}.json`,y=[...o];y[t].jsonBlob=new File([w],N,{type:"application/json"}),u(y)},b=()=>{u([...o,{pngFile:null,name:"",description:"",jsonBlob:null}])},s=async()=>{if(!a){alert("Please enter a collection name.");return}if(o.some(t=>!t.pngFile||!t.jsonBlob)){alert("Please upload a PNG and generate JSON for all NFTs before uploading.");return}c(!0);try{const t=new FormData;o.forEach((y,z)=>{const B=i+z,O=new File([y.pngFile],`${B}.png`,{type:"image/png"});t.append("file",O,`${a}/${B}.png`),t.append("file",y.jsonBlob,`${a}/${B}.json`)});const n=await ge(t,`${i}_collection`,a);if(!n.IpfsHash)throw new Error("No IPFS hash returned");const l=n.IpfsHash;j(l),alert(`Collection uploaded successfully! Base CID: ${l}`);const x=localStorage.getItem("jwtToken");if(!x)throw new Error("Please log in first");const w={category:a,creator:h,tokenIdStart:i,baseCid:l,nftCount:o.length},N=await fetch(`${me}/api/collections`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify(w)});if(!N.ok){const y=await N.json();throw new Error(`Failed to save collection: ${y.message}`)}console.log("Collection saved:",w),f(""),u([{pngFile:null,name:"",description:"",jsonBlob:null}]),j(""),m(i+o.length),window.location.reload()}catch(t){console.error("Upload error:",t),alert(`Upload failed: ${t.message}`)}finally{c(!1)}};return e.jsxs(F,{elevation:3,sx:{padding:3,marginTop:2},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Create Your NFT Collection "}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Step 1: Name your collection and add NFTs. Step 2: Upload everything to IPFS and save to the database! "}),e.jsx(S,{label:"Collection Name (e.g., Earth Series)",fullWidth:!0,margin:"normal",value:a,onChange:t=>f(t.target.value),helperText:"Give your collection a unique name."}),o.map((t,n)=>e.jsxs(P,{sx:{mt:2,mb:3},children:[e.jsx(L,{sx:{mb:2}})," ",e.jsxs(r,{variant:"h6",children:["NFT #",n+1]}),e.jsx(r,{variant:"subtitle1",sx:{mt:1},children:"Upload Image (PNG only) "}),e.jsx("input",{type:"file",accept:"image/png",onChange:l=>v(n,l.target.files[0]),style:{display:"block",marginBottom:"10px"}}),t.pngFile&&e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"NFT Name (e.g., Evil Mark)",fullWidth:!0,margin:"normal",value:t.name,onChange:l=>T(n,"name",l.target.value),helperText:"Enter a catchy name for this NFT."}),e.jsx(S,{label:"Description",fullWidth:!0,margin:"normal",value:t.description,onChange:l=>T(n,"description",l.target.value),helperText:"Describe your NFT (e.g., 'The name said it all')."}),e.jsx(E,{variant:"outlined",onClick:()=>C(n),sx:{mt:1},disabled:!t.pngFile||!t.name||!t.description,children:"Generate Metadata (JSON)"}),t.jsonBlob&&e.jsxs(r,{variant:"body2",sx:{mt:1,color:"green"},children:["Metadata ready: ",t.jsonBlob.name," "]})]})]},n)),e.jsx(E,{variant:"contained",color:"secondary",onClick:b,sx:{mt:2,mr:2},disabled:g||o.some(t=>!t.jsonBlob),children:"Add Another NFT"}),e.jsxs(E,{variant:"contained",color:"primary",onClick:s,sx:{mt:2},disabled:g||!a||o.some(t=>!t.pngFile||!t.jsonBlob),children:[g?e.jsx(W,{size:24}):"Upload Collection"," "]}),p&&e.jsxs(r,{variant:"body2",sx:{mt:2,color:"green"},children:["Collection Uploaded! Base CID: ",p," | Starting Token ID: ",i," "]})]})},Te=()=>{var C;const{state:h}=D();H();const a=h.user,f=(a==null?void 0:a.accountId)||(a==null?void 0:a.account_id),[o,u]=d.useState(""),[g,c]=d.useState("Loading..."),[p,j]=d.useState("NFT Collection"),[i,m]=d.useState(null);d.useEffect(()=>{if((async()=>{let s;if(window.ethereum){s=new q(window.ethereum);try{await window.ethereum.request({method:"eth_requestAccounts"})}catch(t){console.error("User denied account access:",t)}}else console.warn("No injected provider found, falling back to Ganache"),s=new Q("http://127.0.0.1:8545");m(s)})(),a){const s=a.walletAddress||a.wallet_address;s?(u(s),v(s)):c("No wallet address available")}},[a]),d.useEffect(()=>{o&&v(o)},[o]);const v=async b=>{if(!b){c("Invalid wallet address");return}try{console.log("Fetching balance for:",b);const s=await Y(b);if(console.log("API balance data:",s),s!=null&&s.success)c(parseFloat(s.balance).toFixed(6));else throw new Error((s==null?void 0:s.message)||"API returned unsuccessful response")}catch(s){if(console.error("Error fetching balance via API:",s.message),i)try{const t=await i.getBalance(b),n=K(t);c(parseFloat(n).toFixed(6))}catch(t){console.error("Error fetching balance via provider:",t),c("Failed to fetch balance")}else c("Failed to fetch balance: Provider unavailable")}},T=(b,s)=>{j(s),s==="Balance Sender"&&v(o)};return a?e.jsx(M,{maxWidth:"md",sx:{mt:6,mb:4},children:e.jsxs(A.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.8},children:[e.jsxs(F,{elevation:6,sx:{p:4,borderRadius:3,background:"linear-gradient(135deg, #ffffff, #f0f4ff)",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.1)",textAlign:"center"},children:[e.jsx(V,{sx:{bgcolor:"#6e8efb",width:80,height:80,mx:"auto",mb:2,fontSize:36},children:((C=a.username)==null?void 0:C.charAt(0).toUpperCase())||"U"}),e.jsx(r,{variant:"h3",gutterBottom:!0,sx:{fontWeight:"bold",color:"#2c3e50"},children:a.username||"User Profile"}),e.jsxs(P,{sx:{mt:2},children:[e.jsxs(r,{variant:"body1",sx:{color:"#34495e"},children:[e.jsx("strong",{children:"Account ID:"})," ",f||"Not set"]}),e.jsxs(r,{variant:"body1",sx:{color:"#34495e"},children:[e.jsx("strong",{children:"Email:"})," ",a.email||"Not set"]}),e.jsxs(r,{variant:"body1",sx:{color:"#34495e"},children:[e.jsx("strong",{children:"Wallet Address:"})," ",o.substring(0,6),"...",o.substring(o.length-4)||"Not set"]}),e.jsxs(r,{variant:"h5",sx:{mt:2,color:"#27ae60",fontWeight:"bold"},children:["Balance: ",g," ETH"]})]})]}),e.jsxs(oe,{value:p,onChange:T,centered:!0,sx:{mt:4,bgcolor:"#ffffff",borderRadius:2,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)","& .MuiTab-root":{textTransform:"none",fontWeight:"bold",fontSize:"1.1rem",color:"#7f8c8d","&.Mui-selected":{color:"#6e8efb"}},"& .MuiTabs-indicator":{backgroundColor:"#6e8efb",height:3}},children:[e.jsx(I,{label:"NFT Collection",value:"NFT Collection",icon:e.jsx(re,{}),iconPosition:"start"}),e.jsx(I,{label:"Send ETH",value:"Balance Sender",icon:e.jsx(k,{}),iconPosition:"start"}),e.jsx(I,{label:"Create NFT",value:"Create NFT",icon:e.jsx(se,{}),iconPosition:"start"})]}),e.jsx(A.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.5},children:e.jsxs(P,{sx:{mt:3},children:[p==="NFT Collection"&&e.jsx(le,{}),p==="Balance Sender"&&e.jsx(de,{walletAddress:o,provider:i,fetchBalance:v,balance:g}),p==="Create NFT"&&e.jsx(xe,{walletAddress:o,provider:i})]})},p)]})}):e.jsx(M,{sx:{textAlign:"center",mt:4},children:e.jsx(r,{variant:"h6",color:"error",children:"Unauthorized Access"})})};export{Te as default};
