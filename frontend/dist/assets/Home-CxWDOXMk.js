import{a as _,j as e,m as k,B as x,T as l,u as E,r as u,C as B,M as w,b as D,G as b}from"./index-BaiZDlTz.js";import{C as z,a as I,b as O}from"./CardMedia-f9LVn6NY.js";import{B as C}from"./Button-aGJUPGZF.js";import{T as $,F as G,I as q,S as P}from"./TextField-D2dsXHRM.js";const R="http://localhost:8081",Y="https://gray-magic-tortoise-619.mypinata.cloud/ipfs/",A="home_collections_cache",S=(o,s,n)=>{const t=localStorage.getItem(A);if(t){const{collections:r,timestamp:i}=JSON.parse(t),c=Date.now()-i,h=24*60*60*1e3;if(c<h){o(r),s(!1);return}}n()},H=o=>{const s={collections:o,timestamp:Date.now()};localStorage.setItem(A,JSON.stringify(s))},j=async(o,s,n)=>{var t,r;s(!0),n(null);try{const i=localStorage.getItem("jwtToken"),c=await _.get(`${R}/api/collections`,{headers:i?{Authorization:`Bearer ${i}`}:{}});console.log("Collections response:",JSON.stringify(c.data,null,2));const h=c.data.map(d=>({name:d.category,image:`${Y}${d.base_cid}/1.png`,nftCount:d.nft_count,tokenIdStart:d.token_id_start,views:d.views||0}));o(h),H(h),h.length===0&&n("No collections found in the database.")}catch(i){console.error("Error fetching collections:",i),n(`Failed to load collections: ${((r=(t=i.response)==null?void 0:t.data)==null?void 0:r.message)||i.message}`)}finally{s(!1)}},J=async(o,s,n)=>{if(window.ethereum)try{const t=await window.ethereum.request({method:"eth_accounts"});t.length>0&&(o(t[0]),s&&t[0].toLowerCase()!==s.toLowerCase()?(console.warn("MetaMask account differs from logged-in wallet:",t[0],s),n(!0)):n(!1))}catch(t){console.error("Error checking connection:",t)}},M=(o,s,n,t,r)=>{console.log("MetaMask accounts changed:",o),o.length>0?(s(o[0]),n&&o[0].toLowerCase()!==n.toLowerCase()?(console.warn("MetaMask account differs from logged-in wallet:",o[0],n),t(!0)):t(!1),r()):(s(null),t(!1))},K=async(o,s,n)=>{if(!window.ethereum)return alert("MetaMask not detected!");try{const t=await window.ethereum.request({method:"eth_requestAccounts"});o(t[0]),s&&t[0].toLowerCase()!==s.toLowerCase()?n(!0):n(!1)}catch(t){console.error("MetaMask connection error:",t),alert("Failed to connect to MetaMask.")}},Q=({collection:o,onClick:s})=>e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(z,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:"pointer",boxShadow:3},onClick:s,children:[e.jsx(x,{sx:{position:"relative",pt:"100%"},children:e.jsx(I,{component:"img",image:o.image,alt:o.name,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain"}})}),e.jsxs(O,{sx:{flexGrow:1},children:[e.jsx(l,{gutterBottom:!0,variant:"h5",component:"h2",children:o.name}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:[o.nftCount," NFTs"]})]})]})}),ee=()=>{const o=E(),[s,n]=u.useState([]),[t,r]=u.useState(null),[i,c]=u.useState(!0),[h,d]=u.useState(null),[m,Z]=u.useState(localStorage.getItem("wallet_address")),[L,p]=u.useState(!1),[y,N]=u.useState(""),[g,T]=u.useState("a-z");u.useEffect(()=>(J(r,m,p),S(n,c,()=>j(n,c,d)),window.ethereum&&window.ethereum.on("accountsChanged",a=>M(a,r,m,p,()=>S(n,c,()=>j(n,c,d)))),()=>{window.ethereum&&window.ethereum.removeListener("accountsChanged",M)}),[m]);const F=()=>{j(n,c,d)},v=s.filter(a=>a.name.toLowerCase().includes(y.toLowerCase())).sort((a,f)=>g==="a-z"?a.name.localeCompare(f.name):g==="z-a"?f.name.localeCompare(a.name):g==="nft-count"?f.nftCount-a.nftCount:g==="most-viewed"?(f.views||0)-(a.views||0):0);return e.jsx(B,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:[e.jsxs(x,{sx:{background:"linear-gradient(135deg, #6e8efb, #a777e3)",borderRadius:3,p:4,textAlign:"center",color:"white",mb:4,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)"},children:[e.jsx(l,{variant:"h3",component:"h1",gutterBottom:!0,children:"Discover NFT Collections"}),e.jsx(l,{variant:"body1",sx:{mb:2},children:"Explore a world of unique digital assets."}),e.jsx(C,{variant:"contained",color:"secondary",size:"large",onClick:()=>window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),sx:{mt:2},children:"Explore Collections"})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,mb:4},children:[m?e.jsxs(l,{variant:"body1",children:["Logged in as: ",m.substring(0,6),"...",m.substring(m.length-4)]}):e.jsx(l,{variant:"body1",color:"error",children:"Not logged in. Please log in to access all features."}),t?e.jsxs(x,{sx:{textAlign:"center"},children:[e.jsxs(l,{variant:"body2",children:[e.jsx("strong",{children:"Your MetaMask account:"})," ",t.substring(0,6),"...",t.substring(t.length-4)]}),L&&e.jsxs(l,{variant:"body2",color:"error",sx:{mt:1},children:[e.jsx("strong",{children:"Warning:"})," Your MetaMask account doesnâ€™t match your logged-in wallet. NFTs will be minted to your MetaMask account. Please switch accounts."]})]}):e.jsx(C,{variant:"contained",onClick:()=>K(r,m,p),children:"Connect MetaMask"}),e.jsxs(x,{sx:{display:"flex",gap:2,width:"100%",maxWidth:"600px",mt:2},children:[e.jsx($,{label:"Search by name",variant:"outlined",value:y,onChange:a=>N(a.target.value),sx:{flexGrow:1}}),e.jsxs(G,{sx:{minWidth:120},children:[e.jsx(q,{children:"Sort"}),e.jsxs(P,{value:g,onChange:a=>T(a.target.value),label:"Sort",children:[e.jsx(w,{value:"a-z",children:"A-Z"}),e.jsx(w,{value:"z-a",children:"Z-A"}),e.jsx(w,{value:"nft-count",children:"NFT Count"}),e.jsx(w,{value:"most-viewed",children:"Most Viewed"})]})]})]}),e.jsx(C,{variant:"outlined",onClick:F,sx:{mt:2},children:"Reset Collections"})]}),i?e.jsx(x,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(D,{})}):h?e.jsx(l,{color:"error",align:"center",children:h}):v.length===0?e.jsx(l,{align:"center",children:"No collections match your search."}):e.jsx(b,{container:!0,spacing:4,children:v.map(a=>e.jsx(b,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(Q,{collection:a,onClick:()=>o(`/market/${a.name}`)})},a.name))})]})})};export{ee as default};
